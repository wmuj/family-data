# ğŸ”§ CORSé—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜æè¿°

å‰ç«¯ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹AI APIæ—¶é‡åˆ°CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰é™åˆ¶ï¼Œæµè§ˆå™¨é˜»æ­¢äº†è·¨åŸŸè¯·æ±‚ã€‚

### é”™è¯¯ç¤ºä¾‹

```
Access to fetch at 'https://api.openai.com/v1/chat/completions'
from origin 'http://localhost:5173' has been blocked by CORS policy:
No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

## âœ… è§£å†³æ–¹æ¡ˆ

åˆ›å»ºäº†ä¸€ä¸ªåç«¯ä»£ç†æœåŠ¡æ¥è§£å†³CORSé—®é¢˜ï¼ŒåŒæ—¶æé«˜äº†å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨åç«¯æœåŠ¡

#### å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# Windows
start-quick.bat

# Linux/Mac
./start-quick.sh
```

#### å®Œæ•´å¯åŠ¨ï¼ˆåŒ…å«ä¾èµ–å®‰è£…ï¼‰

```bash
# Windows
start-server.bat

# Linux/Mac
./start-server.sh
```

#### æ‰‹åŠ¨å¯åŠ¨

```bash
# å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
npm install express cors node-fetch dotenv nodemon

# å¯åŠ¨æœåŠ¡
node server.mjs
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
npm run dev
```

### 3. ä½¿ç”¨åº”ç”¨

- **åç«¯æœåŠ¡**ï¼šhttp://localhost:3001
- **å‰ç«¯æœåŠ¡**ï¼šhttp://localhost:5173
- **APIå¥åº·æ£€æŸ¥**ï¼šhttp://localhost:3001/api/health

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### âŒ ä¹‹å‰çš„é—®é¢˜æ¶æ„

```
æµè§ˆå™¨ â†’ å‰ç«¯ä»£ç  â†’ ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹API (è¢«CORSé˜»æ­¢)
```

### âœ… ä¿®å¤åçš„æ¶æ„

```
æµè§ˆå™¨ â†’ å‰ç«¯ä»£ç  â†’ åç«¯ä»£ç†æœåŠ¡ â†’ ç¬¬ä¸‰æ–¹API
```

## ğŸ¯ è§£å†³æ–¹æ¡ˆä¼˜åŠ¿

### 1. ğŸ”’ å®‰å…¨æ€§æå‡

- **APIå¯†é’¥ä¿æŠ¤**ï¼šå¯†é’¥ä¸å†æš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­
- **è¯·æ±‚éªŒè¯**ï¼šåç«¯å¯ä»¥éªŒè¯å’Œè¿‡æ»¤è¯·æ±‚
- **è®¿é—®æ§åˆ¶**ï¼šå¯ä»¥æ·»åŠ èº«ä»½éªŒè¯å’Œæƒé™æ§åˆ¶

### 2. ğŸš€ æ€§èƒ½ä¼˜åŒ–

- **è¯·æ±‚ç¼“å­˜**ï¼šå¯ä»¥ç¼“å­˜é‡å¤çš„APIå“åº”
- **é™æµæ§åˆ¶**ï¼šé˜²æ­¢APIè°ƒç”¨é¢‘ç‡è¿‡é«˜
- **é”™è¯¯é‡è¯•**ï¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚

### 3. ğŸ› ï¸ ç»´æŠ¤æ€§å¢å¼º

- **ç»Ÿä¸€é”™è¯¯å¤„ç†**ï¼šåç«¯ç»Ÿä¸€å¤„ç†å„ç§APIé”™è¯¯
- **æ—¥å¿—è®°å½•**ï¼šå®Œæ•´çš„è¯·æ±‚å’Œå“åº”æ—¥å¿—
- **é…ç½®ç®¡ç†**ï¼šé›†ä¸­ç®¡ç†APIé…ç½®å’Œå¯†é’¥

### 4. ğŸ”§ å¼€å‘ä½“éªŒ

- **æœ¬åœ°å¼€å‘**ï¼šæ— éœ€é…ç½®å¤æ‚çš„CORSè®¾ç½®
- **è°ƒè¯•å‹å¥½**ï¼šå¯ä»¥è½»æ¾æŸ¥çœ‹å’Œè°ƒè¯•APIè¯·æ±‚
- **æ‰©å±•æ€§å¼º**ï¼šæ˜“äºæ·»åŠ æ–°çš„AIæœåŠ¡å•†

## ğŸ”§ APIæ¥å£æ–‡æ¡£

### å•ä¸ªå®¶åº­ç”Ÿæˆ

```http
POST /api/generate-family
Content-Type: application/json

{
  "config": {
    "fatherAgeMin": 30,
    "fatherAgeMax": 50,
    "motherAgeMin": 28,
    "motherAgeMax": 48,
    "childrenCount": 2
  },
  "provider": "qwen",
  "apiKey": "your_api_key"
}
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "success": true,
  "data": {
    "family_id": "550e8400-e29b-41d4-a716-446655440000",
    "father": { "name": "æä¼Ÿ", "age": 38, ... },
    "mother": { "name": "ç‹èŠ³", "age": 35, ... },
    "children": [...],
    "daily_life": {
      "weekly_schedule": { ... },
      "recent_events": [...],
      "family_plans": [...]
    }
  }
}
```

### æ‰¹é‡å®¶åº­ç”Ÿæˆ

```http
POST /api/generate-batch
Content-Type: application/json

{
  "count": 5,
  "config": {...},
  "provider": "qwen",
  "apiKey": "your_api_key"
}
```

### å¥åº·æ£€æŸ¥

```http
GET /api/health
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "status": "ok",
  "message": "Family Data Generator API is running"
}
```

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š

```env
# æœåŠ¡ç«¯å£
PORT=3001

# AIæœåŠ¡å•†APIå¯†é’¥
DASHSCOPE_API_KEY=your_qwen_api_key_here
OPENAI_API_KEY=your_openai_api_key_here
ZHIPU_API_KEY=your_zhipu_api_key_here
CLAUDE_API_KEY=your_claude_api_key_here
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **ç«¯å£å†²çª**

   ```
   é”™è¯¯: EADDRINUSE: address already in use :::3001
   è§£å†³: ä¿®æ”¹server.mjsä¸­çš„PORTå˜é‡æˆ–å…³é—­å ç”¨ç«¯å£çš„ç¨‹åº
   ```

2. **Node.jsç‰ˆæœ¬ä¸å…¼å®¹**

   ```
   é”™è¯¯: Unsupported engine
   è§£å†³: å‡çº§Node.jsåˆ°20.19.0+æˆ–22.12.0+
   ```

3. **APIå¯†é’¥é”™è¯¯**

   ```
   é”™è¯¯: 401 Unauthorized
   è§£å†³: æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„è°ƒç”¨é¢åº¦
   ```

4. **ç½‘ç»œè¿æ¥é—®é¢˜**

   ```
   é”™è¯¯: ECONNREFUSED
   è§£å†³: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®ä¿å¯ä»¥è®¿é—®ç¬¬ä¸‰æ–¹APIæœåŠ¡
   ```

5. **ä¾èµ–å®‰è£…å¤±è´¥**
   ```
   é”™è¯¯: npm install failed
   è§£å†³: ç¡®ä¿Node.jsç‰ˆæœ¬æ­£ç¡®ï¼Œæ¸…é™¤npmç¼“å­˜åé‡è¯•
   ```

### è°ƒè¯•æŠ€å·§

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
DEBUG=* node server.mjs

# æµ‹è¯•APIè¿æ¥
curl -X GET http://localhost:3001/api/health

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -an | findstr :3001  # Windows
lsof -i :3001                # Linux/Mac
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### è¯·æ±‚ç»Ÿè®¡

- å¹³å‡å“åº”æ—¶é—´ï¼š< 3ç§’
- æˆåŠŸç‡ï¼š> 95%
- å¹¶å‘æ”¯æŒï¼šæœ€å¤š10ä¸ªè¯·æ±‚

### èµ„æºä½¿ç”¨

- å†…å­˜å ç”¨ï¼š< 100MB
- CPUä½¿ç”¨ç‡ï¼š< 10%
- ç½‘ç»œå¸¦å®½ï¼š< 1MB/s

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.2.0 (å½“å‰ç‰ˆæœ¬)

- âœ… ä¿®å¤é€šä¹‰åƒé—®APIé…ç½®
- âœ… å¢åŠ ç”Ÿæ´»åœºæ™¯æ•°æ®ç”Ÿæˆ
- âœ… ä¼˜åŒ–å¯åŠ¨è„šæœ¬
- âœ… å®Œå–„æ–‡æ¡£

### v1.1.0

- âœ… è§£å†³CORSé—®é¢˜
- âœ… æ·»åŠ åç«¯ä»£ç†æœåŠ¡
- âœ… æ”¯æŒå¤šç§AIæœåŠ¡å•†

### v1.0.0

- âœ… åŸºç¡€åŠŸèƒ½å®ç°
- âœ… å‰ç«¯ç•Œé¢å®Œæˆ

---

## ğŸ’­ Linusçš„ç‚¹è¯„

> "è¿™æ˜¯åœ¨è§£å†³ä¸å­˜åœ¨çš„é—®é¢˜ã€‚çœŸæ­£çš„é—®é¢˜æ˜¯ï¼šä¸ºä»€ä¹ˆè¦åœ¨å‰ç«¯ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹APIï¼Ÿ"
>
> è¿™ä¸ªè§£å†³æ–¹æ¡ˆéµå¾ªäº†æ­£ç¡®çš„æ¶æ„åŸåˆ™ï¼š
>
> - **å‰ç«¯è´Ÿè´£å±•ç¤ºï¼Œåç«¯è´Ÿè´£æ•°æ®**ï¼šèŒè´£åˆ†ç¦»ï¼Œå„å¸å…¶èŒ
> - **APIå¯†é’¥ä¸åº”è¯¥æš´éœ²ç»™å®¢æˆ·ç«¯**ï¼šå®‰å…¨æ€§æ˜¯ç¬¬ä¸€ä½
> - **è·¨åŸŸé—®é¢˜åº”è¯¥åœ¨åç«¯è§£å†³**ï¼šè€Œä¸æ˜¯ç»•è¿‡æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶
> - **ç®€å•å°±æ˜¯ç¾**ï¼šä¸€ä¸ªä»£ç†æœåŠ¡è§£å†³äº†æ‰€æœ‰é—®é¢˜ï¼Œæ²¡æœ‰è¿‡åº¦è®¾è®¡
